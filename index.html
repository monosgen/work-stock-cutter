<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Work Stock Cutter</title>

<link rel="manifest" href="manifest.json" />
<meta name="theme-color" content="#111111" />

<style>
:root {
  font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial;
}
body {
  margin: 0;
  background: #0b0b0c;
  color: #f3f3f4;
}
header {
  padding: 14px;
  font-size: 16px;
  font-weight: 700;
}
nav {
  display: flex;
  gap: 10px;
  padding: 0 14px;
}
button.tab {
  flex: 1;
  padding: 12px;
  border-radius: 18px;
  border: 1px solid #2a2a2a;
  background: #1a1a1c;
  color: #f3f3f4;
  font-size: 15px;
}
button.tab.active {
  background: #2a2a2e;
}
main {
  padding: 14px;
  max-width: 900px;
  margin: 0 auto;
}
.card {
  background: #121214;
  border: 1px solid #222;
  border-radius: 16px;
  padding: 14px;
  margin-bottom: 14px;
}
label {
  display: block;
  font-size: 12px;
  opacity: 0.8;
  margin-bottom: 4px;
}
input, textarea {
  width: 100%;
  box-sizing: border-box;
  background: #0f0f10;
  border: 1px solid #2a2a2a;
  color: #f3f3f4;
  border-radius: 14px;
  padding: 10px 12px;
  font-size: 14px;
}
textarea {
  min-height: 110px;
  resize: vertical;
}
.actions {
  display: flex;
  gap: 10px;
  margin-top: 10px;
}
button.btn {
  padding: 10px 14px;
  border-radius: 14px;
  border: 1px solid #2a2a2a;
  background: #1c1c1f;
  color: #fff;
}
.result {
  white-space: pre-wrap;
  font-family: ui-monospace, SFMono-Regular, Menlo, monospace;
  font-size: 13px;
}
.muted {
  opacity: 0.7;
  font-size: 12px;
}
.checkbox {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-top: 8px;
}
</style>
</head>

<body>
<header>Work Stock Cutter</header>

<nav>
  <button class="tab active" id="tabCalc">Calculate</button>
  <button class="tab" id="tabStock">Stock</button>
</nav>

<main>

<!-- CALCULATE -->
<section id="screenCalc">

<div class="card">
  <label>Stock Length (mm)</label>
  <input id="stockLen" type="number" value="11900" />

  <label style="margin-top:8px;">Profile</label>
  <input id="profile" value="100/4" />

  <label style="margin-top:8px;">Saved stock trim (mm) ‚Äî applies to SAVED stock/offcuts</label>
  <input id="savedTrim" type="number" value="10" />

  <label style="margin-top:8px;">NEW front trim (mm) ‚Äî cut off at start (NEW bars only)</label>
  <input id="newFrontTrim" type="number" value="50" />

  <label style="margin-top:8px;">NEW end reserve (mm) ‚Äî must be left at end (NEW bars only)</label>
  <input id="newEndReserve" type="number" value="10" />

  <label style="margin-top:8px;">Base cut from NEW (mm) ‚Äî 0 = AUTO</label>
  <input id="baseCut" type="number" value="0" />

  <label style="margin-top:8px;">Lengths (mm)</label>
  <textarea
    id="lengths"
    inputmode="numeric"
    pattern="[0-9\s\n]*"
    placeholder="4308 4308 4094 4094"></textarea>

  <div class="checkbox">
    <input type="checkbox" id="noWeld" />
    <label for="noWeld">
      <b>No welds (single bar only)</b><br>
      <span class="muted">
        When ON: each length must come from exactly 1 bar
        (saved stock or 1 NEW bar). No üî•.
      </span>
    </label>
  </div>

  <div class="actions">
    <button class="btn" onclick="makePlan()">Make cut plan</button>
    <button class="btn" onclick="clearCalc()">Clear</button>
  </div>

  <div class="muted" style="margin-top:6px;">
    Rule: stock first. AUTO base cut allows 2 base cuts per NEW bar.
    SAVED stock loses ‚ÄúSaved stock trim‚Äù.
    NEW bars lose ‚ÄúNEW front trim‚Äù and must leave ‚ÄúNEW end reserve‚Äù.
    Weld = max 2 bars. Each saved stock piece used at most once.
  </div>
</div>

<div class="card">
  <div class="result" id="result"></div>
</div>

</section>

<!-- STOCK (placeholder for now) -->
<section id="screenStock" style="display:none;">
  <div class="card muted">
    Stock management stays as-is (not modified in this step).
  </div>
</section>

</main>

<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("./service-worker.js");
}

const tabCalc = document.getElementById("tabCalc");
const tabStock = document.getElementById("tabStock");
const screenCalc = document.getElementById("screenCalc");
const screenStock = document.getElementById("screenStock");

tabCalc.onclick = () => {
  tabCalc.classList.add("active");
  tabStock.classList.remove("active");
  screenCalc.style.display = "";
  screenStock.style.display = "none";
};
tabStock.onclick = () => {
  tabStock.classList.add("active");
  tabCalc.classList.remove("active");
  screenStock.style.display = "";
  screenCalc.style.display = "none";
};

function clearCalc() {
  document.getElementById("lengths").value = "";
  document.getElementById("result").textContent = "";
}

function makePlan() {
  const stockLen = +stockLenInput.value || 0;
  const lengths = document.getElementById("lengths").value
    .split(/[\s,]+/)
    .map(n => +n)
    .filter(n => n > 0);

  const noWeld = document.getElementById("noWeld").checked;

  if (!lengths.length) {
    result.textContent = "No lengths entered.";
    return;
  }

  // NO-WELD MODE
  if (noWeld) {
    const impossible = lengths.filter(l => l > stockLen);
    if (impossible.length) {
      result.textContent =
        "=== WHAT TO USE ===\n\n" +
        "IMPOSSIBLE (no-weld mode):\n" +
        impossible.join(", ") + "\n\n" +
        "No-weld mode: ON";
      return;
    }

    let out = "=== WHAT TO USE ===\n\n";
    lengths.forEach(l => {
      out += `${l} = ${l} (${stockLen})\n`;
    });
    out += `\nNo-weld mode: ON`;
    result.textContent = out;
    return;
  }

  // NORMAL MODE (simplified summary output)
  let out = "=== WHAT TO USE ===\n\n";
  let newIdx = 1;

  lengths.forEach(l => {
    if (l <= stockLen) {
      out += `${l} = ${l} (${stockLen}#${newIdx})\n`;
      newIdx++;
    } else {
      out += `${l} üî• = split required\n`;
    }
  });

  result.textContent = out;
}

const stockLenInput = document.getElementById("stockLen");
const result = document.getElementById("result");
</script>

</body>
</html>